# 拼图棋盘游戏 - 测试指南

## 🎮 如何开始测试

### 1. 启动游戏

```bash
# 确保在项目根目录
cd "c:\Users\q3499\Desktop\新建文件夹 (7)"

# 启动开发服务器
pnpm dev

# 访问游戏页面
# 浏览器打开: http://localhost:5174/chess
```

---

## ✅ 基础功能测试清单

### 测试 1: 棋盘渲染
- [ ] 棋盘是否显示为 4×4 网格？
- [ ] 背景颜色是否为红色？
- [ ] 网格线是否清晰可见（白色）？
- [ ] 右侧规则面板是否显示？

### 测试 2: 棋子渲染
- [ ] 玩家1的4个棋子是否在顶部第1行（row 0）？
- [ ] 玩家2的4个棋子是否在底部第1行（row 3）？
- [ ] SVG 图片是否正确显示（不是broken image）？
- [ ] 棋子是否有不同的拼图形状？

### 测试 3: 棋子选择
- [ ] 点击己方棋子时，格子是否高亮？
- [ ] 点击对方棋子时，无反应？
- [ ] 再次点击同一棋子，取消选中？
- [ ] 当前玩家指示器是否正确显示？

### 测试 4: 棋子移动
- [ ] 选中棋子后，点击相邻空格子，棋子是否移动？
- [ ] 移动后，回合数是否增加？
- [ ] 移动后，当前玩家是否切换？
- [ ] 非法移动（超出范围）是否被阻止？

### 测试 5: 边缘匹配（核心机制）

#### 测试场景 1: 凸凹匹配
```
目标: 验证 1+ 和 1- 可以拼接

步骤:
1. 选择一个有 1+ 边缘的棋子
2. 将其移动到有 1- 边缘的棋子旁边
3. 预期: 移动成功，棋子拼接
```

#### 测试场景 2: 类型不匹配
```
目标: 验证 1+ 和 1`- 不能拼接

步骤:
1. 选择一个有 1+ 边缘的棋子
2. 尝试将其移动到有 1`- 边缘的棋子旁边
3. 预期: 移动失败（无法拼接）
```

#### 测试场景 3: 堆叠
```
目标: 验证棋子可以堆叠

步骤:
1. 选择己方棋子A
2. 将其移动到己方棋子B所在的格子
3. 预期: 两个棋子在同一格子（堆叠）
```

### 测试 6: 游戏控制
- [ ] "跳过"按钮是否切换回合？
- [ ] "悔棋"按钮是否撤销上一步？
- [ ] "重置"按钮是否重新开始游戏？
- [ ] 游戏结束后，按钮是否正确禁用？

### 测试 7: 胜利条件
```
目标: 验证玩家1获胜

步骤:
1. 将玩家1的所有4个棋子移动到底部行（row 3）
2. 预期: 显示 "🎉 玩家 1 获胜！"
```

---

## 🐛 已知问题记录

### 问题 1: SVG 文件加载失败

**症状**: 棋子显示为破损图片图标

**可能原因**:
- SVG 文件路径错误
- 文件名包含中文字符导致编码问题
- Vite 服务器未正确处理 `/SVG/` 目录

**调试步骤**:
1. 打开浏览器开发者工具（F12）
2. 查看 Console 是否有 404 错误
3. 查看 Network 标签，检查 SVG 文件请求
4. 尝试直接访问: `http://localhost:5174/SVG/资源 1.svg`

**临时解决方案**:
```typescript
// 在 pieces.ts 中使用相对路径
svgPath: './assets/pieces/piece1.svg'
```

### 问题 2: 棋子点击无响应

**症状**: 点击棋子后没有高亮或移动

**调试步骤**:
1. 打开浏览器控制台查看是否有 JavaScript 错误
2. 检查 `handleCellClick` 函数是否被调用
3. 验证 `currentPlayer` 的值是否正确

### 问题 3: 移动总是失败

**症状**: 无论如何点击，棋子都不移动

**可能原因**:
- `MoveValidator` 验证过于严格
- 边缘匹配逻辑有 bug
- `executeMove` 参数构建错误

**调试步骤**:
1. 在 `handleCellClick` 中添加 `console.log`
2. 检查 Move 对象的结构
3. 查看 `executeMove` 返回值

---

## 🧪 单元测试

### 运行所有测试
```bash
pnpm test:unit
```

### 运行特定测试
```bash
# 仅测试 EdgeMatcher
pnpm vitest run EdgeMatcher

# 仅测试 MoveValidator
pnpm vitest run MoveValidator

# 监视模式（文件改变时自动重跑）
pnpm vitest watch
```

### 预期结果
```
✓ EdgeMatcher.spec.ts (34 tests) 34 passed
✓ 其他测试文件...

总计: 应该所有测试通过 ✅
```

---

## 📊 性能测试

### 1. 渲染性能
- 打开 Chrome DevTools > Performance
- 录制棋子移动操作
- 检查 FPS 是否稳定在 60fps
- 查看是否有不必要的重渲染

### 2. 内存泄漏
- 打开 Chrome DevTools > Memory
- 进行多次"重置"操作
- 查看堆快照，检查是否有泄漏

---

## 🎯 压力测试场景

### 场景 1: 快速连续操作
```
1. 快速点击多个棋子
2. 快速进行多次移动
3. 快速点击"悔棋"多次
4. 预期: 无卡顿，无错误
```

### 场景 2: 边界情况
```
1. 尝试移动到棋盘外（应被阻止）
2. 在没有棋子的格子点击（应无反应）
3. 在对手回合点击己方棋子（应无反应）
```

### 场景 3: 长时间游戏
```
1. 进行 50+ 回合的游戏
2. 查看性能是否下降
3. 查看内存使用是否增长
```

---

## 📝 测试报告模板

```markdown
## 测试报告 - YYYY-MM-DD

### 测试环境
- 浏览器: Chrome 120 / Firefox 121 / Safari 17
- 操作系统: Windows 11 / macOS 14 / Linux
- 屏幕分辨率: 1920x1080

### 测试结果
- [ ] 基础渲染: ✅ / ❌
- [ ] 棋子选择: ✅ / ❌
- [ ] 棋子移动: ✅ / ❌
- [ ] 边缘匹配: ✅ / ❌
- [ ] 游戏控制: ✅ / ❌
- [ ] 胜利条件: ✅ / ❌

### 发现的问题
1. [问题描述]
   - 重现步骤: ...
   - 预期行为: ...
   - 实际行为: ...
   - 截图: ...

### 改进建议
- 建议1: ...
- 建议2: ...
```

---

## 🔍 调试技巧

### 1. 查看游戏状态
```javascript
// 在浏览器控制台执行
window.__CHESS_DEBUG__ = true

// 查看当前棋盘状态
console.log(gameEngine.value.getGameState())

// 查看所有棋子位置
console.log(gameEngine.value.getBoard().getCells())
```

### 2. 启用详细日志
```typescript
// 在 ChessBoard.vue 中添加
onMounted(() => {
  gameEngine.value = new GameEngine()
  gameEngine.value.startGame()
  console.log('🎮 Game initialized:', gameEngine.value.getGameState())
})
```

### 3. 可视化边缘类型
```vue
<!-- 在棋子上显示边缘信息 -->
<div class="edge-debug">
  <div>↑{{ piece.shape.top }}</div>
  <div>→{{ piece.shape.right }}</div>
  <div>↓{{ piece.shape.bottom }}</div>
  <div>←{{ piece.shape.left }}</div>
</div>
```

---

## ✨ 下一步

完成基础测试后：
1. 记录所有发现的问题
2. 创建 GitHub Issues（如果使用版本控制）
3. 优先修复 P0 级别的 bug
4. 收集用户反馈
5. 迭代改进 UI/UX

祝测试顺利！🚀
